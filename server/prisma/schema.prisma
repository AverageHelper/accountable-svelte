// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "mysql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model User {
  uid               String     @id
  currentAccountId  String
  passwordHash      String
  passwordSalt      String
  requiredAddtlAuth Json /// Array of MFAValidation strings
  mfaRecoverySeed   String?
  totpSeed          String?
  keys              UserKeys?
  data              DataItem[]
}

model UserKeys {
  userId         String  @id
  user           User    @relation(fields: [userId], references: [uid])
  dekMaterial    String
  passSalt       String
  oldDekMaterial String?
  oldPassSalt    String?

  @@index([userId])
}

model DataItem {
  userId       String
  collectionId CollectionID
  docId        String
  ciphertext   String
  objectType   String
  cryption     Cryption     @default(v0)
  user         User         @relation(fields: [userId], references: [uid])

  @@id([userId, collectionId, docId])
  @@index([userId])
}

enum CollectionID {
  accounts
  attachments
  locations
  tags
  transactions
}

enum Cryption {
  v0
  v1
}
